
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Formula Grammar - Formulaic</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#02a6f2">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#operators" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Formulaic" class="md-header__button md-logo" aria-label="Formulaic" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Formulaic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Formula Grammar
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Formulaic" class="md-nav__button md-logo" aria-label="Formulaic" data-md-component="logo">
      
  <img src="../../assets/images/logo.svg" alt="logo">

    </a>
    Formulaic
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        Overview
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Basic Usage
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Basic Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Basic Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../formulas/" class="md-nav__link">
        What are formulas?
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Formula Grammar
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Formula Grammar
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    Operators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transforms" class="md-nav__link">
    Transforms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviours-and-conventions" class="md-nav__link">
    Behaviours and Conventions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Advanced Usage
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Advanced Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Advanced Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        API
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#operators" class="md-nav__link">
    Operators
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transforms" class="md-nav__link">
    Transforms
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#behaviours-and-conventions" class="md-nav__link">
    Behaviours and Conventions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Formula Grammar</h1>
                
                <p>This section of the documentation describes the formula grammar used by
Formulaic. It is almost identical that used by patsy and R, and so most formulas
should work without modification. However, there are some differences, which are
called out below.</p>
<h2 id="operators">Operators</h2>
<p>In this section, we introduce a complete list of the <em>grammatical</em> operators
that you can use by default in your formulas. They are listed such that each
section (demarcated by "-----") has higher precedence then the block that
follows. When you write a formula involving several operators of different
precedence, those with higher precedence will be resolved first. "Arity" is the
number of arguments the operator takes. Within operators of the same precedence,
all binary operators are evaluated from left to right (they are
left-associative). To highlight differences in grammar betweeh formulaic, patsy
and R, we highlight any differences below. If there is a checkmark the
Formulaic, Patsy and R columns, then the grammar is consistent across all three,
unless otherwise indicated.</p>
<table>
<thead>
<tr>
<th align="right">Operator</th>
<th align="center">Arity</th>
<th align="left">Description</th>
<th align="center">Formulaic</th>
<th align="center">Patsy</th>
<th align="center">R</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right"><code>"..."</code><sup id="fnref5:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
<td align="center">1</td>
<td align="left">String literal.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right"><code>[0-9]+\.[0-9]+</code><sup id="fnref4:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
<td align="center">1</td>
<td align="left">Numerical literal.</td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right"><code>`...`</code><sup id="fnref3:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
<td align="center">1</td>
<td align="left">Quotes fieldnames within the incoming dataframe, allowing the use of special characters, e.g. <code>`my|special$column!`</code></td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>{...}</code><sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
<td align="center">1</td>
<td align="left">Quotes python operations, as a more convenient way to do Python operations than <code>I(...)</code>, e.g. <code>{`my|col`**2}</code></td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right"><code>&lt;function&gt;(...)</code><sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
<td align="center">1</td>
<td align="left">Python transform on column, e.g. <code>my_func(x)</code> which is equivalent to <code>{my_func(x)}</code></td>
<td align="center">âœ“<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup></td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right"><code>(...)</code></td>
<td align="center">1</td>
<td align="left">Groups operations, overriding normal precedence rules. All operations with the parentheses are performed before the result of these operations is permitted to be operated upon by its peers.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right">**</td>
<td align="center">2</td>
<td align="left">Includes all n-th order interactions of the terms in the left operand, where n is the (integral) value of the right operand, e.g. <code>(a+b+c)**2</code> is equivalent to `a + b + c + a:b + a:c + b:c</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">^</td>
<td align="center">2</td>
<td align="left">Alias for <code>**</code>.</td>
<td align="center">ðŸ—™</td>
<td align="center">ðŸ—™<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup></td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right"><code>:</code></td>
<td align="center">2</td>
<td align="left">Adds a new term that corresponds to the interaction of its operands (i.e. their elementwise product).</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right"><code>*</code></td>
<td align="center">2</td>
<td align="left">Includes terms for each of the additive and interactive effects of the left and right operands, e.g. <code>a * b</code> is equivalent to <code>a + b + a:b</code>.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>/</code></td>
<td align="center">2</td>
<td align="left">Adds terms describing nested effects. It expands to the addition of a new term for the left operand and the interaction of all left operand terms with the right operand, i.e <code>a / b</code> is equivalent to <code>a + a:b</code>, <code>(a + b) / c</code> is equivalent to <code>a + b + a:b:c</code>, and <code>a/(b+c)</code> is equivalent to <code>a + a:b + a:c</code>.<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup></td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>%in%</code></td>
<td align="center">2</td>
<td align="left">Alias for <code>/</code>.</td>
<td align="center">ðŸ—™</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right"><code>+</code></td>
<td align="center">2</td>
<td align="left">Adds a new term to the set of features.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>-</code></td>
<td align="center">2</td>
<td align="left">Removes a term from the set of features (if present).</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>+</code></td>
<td align="center">1</td>
<td align="left">Returns the current term unmodified (not very useful).</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>-</code></td>
<td align="center">1</td>
<td align="left">Negates a term (only implemented for 0, in which case it is replaced with <code>1</code>).</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">-----</td>
<td align="center"></td>
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="right"><code>~</code></td>
<td align="center">1,2</td>
<td align="left">Separates the target features from the input features. If absent, it is assumed that we are considering only the the input features. Unless otherwise indicated, it is assumed that the input features implicitly include an intercept.</td>
<td align="center">âœ“<sup id="fnref:5"><a class="footnote-ref" href="#fn:5">5</a></sup></td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
</tbody>
</table>
<h2 id="transforms">Transforms</h2>
<p>Formulaic supports arbitrary transforms, any of which can also preserve state so
that new data can undergo the same transformation as that used during modelling.
The currently implemented transforms are shown below. Commonly used transforms
that have <em>not</em> been implemented by <code>formualaic</code> are explicitly noted also.</p>
<table>
<thead>
<tr>
<th align="right">Transform</th>
<th align="left">Description</th>
<th align="center">Formulaic</th>
<th align="center">Patsy</th>
<th align="center">R</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right"><code>I(...)</code></td>
<td align="left">Identity transform, allowing arbitrary Python/R operations, e.g. <code>I(x+y)</code>. Note that in <code>formulaic</code>, it is more idiomatic to use <code>{x+y}</code>.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>C(...)</code></td>
<td align="left">Categorically encode a column, e.g. <code>C(x)</code></td>
<td align="center">partial<sup id="fnref:6"><a class="footnote-ref" href="#fn:6">6</a></sup></td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>center(...)</code></td>
<td align="left">Shift column data so mean is zero.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right"><code>scale(...)</code></td>
<td align="left">Shift column so mean is zero and variance is 1.</td>
<td align="center">âœ“</td>
<td align="center">âœ“<sup id="fnref:7"><a class="footnote-ref" href="#fn:7">7</a></sup></td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>standardize(...)</code></td>
<td align="left">Alias of <code>scale</code>.</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
<td align="center">ðŸ—™</td>
</tr>
<tr>
<td align="right"><code>bs(...)</code></td>
<td align="left">Generates a B-Spline basis, allowing non-linear fits.</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>cr(...)</code></td>
<td align="left">Generates a natural cubic spline basis, allowing non-linear fits.</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>cc(...)</code></td>
<td align="left">Generates a cyclic cubic spline basis, allowing non-linear fits.</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right"><code>te(...)</code></td>
<td align="left">Generates a tensor product smooth.</td>
<td align="center">ðŸ—™</td>
<td align="center">âœ“</td>
<td align="center">âœ“</td>
</tr>
<tr>
<td align="right">...</td>
<td align="left">Others? Contributions welcome!</td>
<td align="center">?</td>
<td align="center">?</td>
<td align="center">?</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Formulaic does not (yet) support including extra terms in the formula that
will not result in additions to the dataframe, for example model annotations
like R's <code>offset(...)</code>.</p>
</div>
<h2 id="behaviours-and-conventions">Behaviours and Conventions</h2>
<p>Beyond the formula operator grammar itself there are some differing behaviours
and conventions of which you should be aware.</p>
<ul>
<li>Formulaic follows Patsy and then enhanced <code>Formula</code> R package in that both
    sides of the <code>~</code> operator are treated considered to be using the formula
    grammar, with the only difference being that the right hand side attracts an
    intercept by default. In vanilla R, the left hand side is treated as R code
    (and so <code>x + y ~ z</code> would result in a single column on the left-hand-side).
    You can recover vanilla R's behaviour by nesting the operations in a Python
    operator block (as described in the operator table): <code>{y1 + y2} ~ a + b</code>.</li>
<li>Formula terms in Formulaic are always sorted first by the order of the
    interaction, and then alphabetically. In R and patsy, this second ordering
    is done in the order that columns were introduced to the formula (patsy
    additionally sorts by which fields are involved in the interactions). As a
    result formulas generated by <code>formulaic</code> with the same set of fields will
    always generate the same model matrix.</li>
<li>Formulaic follows patsy's more rigourous handling of whether or not to
    include an intercept term. In R, <code>b-1</code> and <code>(b-1)</code> both do not have an
    intercept, whereas in Formulaic and Patsy the parentheses are resolved
    first, and so the first does not have an intercept and the second does
    (because and implicit '1 +' is added prepended to the right hand side of the
    formula).</li>
<li>Formulaic borrows a clever algorithm introduced by Patsy to carefully choose
    where to reduce the rank of the model matrix in order to ensure that the
    matrix is structurally full rank. This avoids producing over-specified model
    matrices in contexts that R would (since it only considers local full-rank
    structure, rather than global structure). You can read more about this in
    <a href="https://patsy.readthedocs.io/en/latest/formulas.html">Patsy's documentation</a>.</li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>This "operator" is actually part of the tokenisation process.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref4:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref5:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Formulaic additionally supports quoted fields with special characters, e.g. <code>my_func(`my|special+column`)</code>.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>The caret operator is not supported, but will not cause an error. It is ignored by the patsy formula parser, and treated as XOR Python operation on column.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>This somewhat confusing operator is useful when you want to include hierachical features in your data, and where certain interaction terms do not make sense (particularly in ANOVA contexts). For example, if <code>a</code> represents countries, and <code>b</code> represents cities, then the full product of terms from <code>a * b === a + b + a:b</code> does not make sense, because any value of <code>b</code> is guaranteed to coincide with a value in <code>a</code>, and does not independently add value. Thus, the operation <code>a / b === a + a:b</code> results in more sensible dataset. As a result, the <code>/</code> operator is right-distributive, since if <code>b</code> and <code>c</code> were both nested in <code>a</code>, you would want <code>a/(b+c) === a + a:b + a:c</code>. Likewise, the operator is not left-distributive, since if <code>c</code> is nested under both <code>a</code> and <code>b</code> separately, then you want <code>(a + b)/c === a + b + a:b:c</code>. Lastly, if <code>c</code> is nested in <code>b</code>, and <code>b</code> is nested in <code>a</code>, then you would want <code>a/b/c === a + a:(b/c) === a + a:b + a:b:c</code>.&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p>Formulaic additionally supports more than one <code>~</code> which splits the features into as many groups as you like.&#160;<a class="footnote-backref" href="#fnref:5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:6">
<p>Formulaic only supports one-hot encoding, and does not yet support arbitrary contrast matrices or specification which field to leave out in reduced rank, etc.&#160;<a class="footnote-backref" href="#fnref:6" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:7">
<p>Patsy uses the <code>rescale</code> keyword rather than <code>scale</code>, but provides the same functionality.&#160;<a class="footnote-backref" href="#fnref:7" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quickstart" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Quickstart
            </div>
          </div>
        </a>
      
      
        
        <a href="../../advanced/intro/" class="md-footer__link md-footer__link--next" aria-label="Next: Introduction" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Introduction
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.febc23d1.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>